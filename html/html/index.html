<html>
    <head>
        <script src="../htmldependencies/brython.js"></script>
        <script src="../htmldependencies/brython_stdlib.js"></script>
        <link rel="stylesheet" href="../htmldependencies/style.css">
        <meta http-equiv="refresh" content="120">
	<title>MNSF Dashboard</title>
    </head>
    <body onload="brython()">
        <div>
            <h3 id="headerState"></h3>
            <h3 id="updateTime">Update Time: </h3>
            <!--<form method="post" action="restart.php">
                <input type="submit" value="Restart Services">
	    </form>-->
	    <a href="restart.php"><button>Restart</button></a>
        </div>
        <div class="first_row">
            <div class="navigation">
                <a href="index.html"><button>Overview</button></a>
                <a href="assets.html"><button>Assets</button></a>
                <a href="positions.html"><button>Positions</button></a>
                <a href="breakdown.html"><button>Breakdown</button></a>
                <a href="leverage.html"><button>Leverage</button></a>
                <a href="funding.html"><button>Funding</button></a>
                <a href="currentFunding.html"><button>Current Funding</button></a>
                <a href="report.html"><button>Report</button></a>
		<a href="test_page.php"><button>Rewards Cumulative</button></a>
                <a href="spread.html"><button>Spread</button></a>
                <a href="loans.php"><button>Loans</button></a>
                <a href="nav.html"><button>GAV</button></a>
		<a href="daily_cum.php"><button>24 Hour Report</button></a>
		<a href="monthly_reward.php"><button>Monthly Report</button></a>
		<a href="daily_calculation.php"><button>Daily Calculation</button></a>
                <a href="http://52.56.101.27/hist.html"><button>Historic Funding</button></a>
            </div>
        </div>
    <div class="fillBack">
    <div class="second_row">
        <div id="test" class="balances"><h2>Total Balance</h2></div>
    </div>
    </div>
    <br>
    <div class="fillBack">
    <div class="second_row">
        <div id="one-three" class="CoinAsset"><h2>Net Positions</h2></div>
    </div>
    </div>
    <div class="fillBack">
        <h2>Leverage</h2>
        <div id="two" class="third_row"></div>
    </div>
    <div class="fillBack">
        <h2>Liquidation Risk</h2>
        <div id="three" class="fourth_row"></div>
    </div>
    <script type="text/python">
    from browser import document, html, window
    from browser.html import TABLE, TR, TH, TD
    import tmp, total, importlib

    document["updateTime"]<= tmp.time

    def getHeaders(dic):
            headers = []
            for i in dic[0]:
                    headers.append(i)
            return headers

    def getValues(dic):
            all_values = []
            for i in dic:
                values = []
                for j in i:
                    values.append(i[j])
                all_values.append(values)
            return all_values

    def speed():
        importlib.reload(total)
        document["test"].innerHTML = ""
        overall = round(total.over, 2)
        overall = '{:,.2f}'.format(overall)
        calcul = round(total.calc, 2)
        calcul = '{:,.2f}'.format(calcul)
        staked = round(total.stake, 2)
        staked = '{:,.2f}'.format(staked)
        deltoid = float(total.delta)
        deltoid = round(deltoid, 2)
        deltoid = ('{:,.2f}' if deltoid >= 0 else '-{:,.2f}').format(abs(deltoid))  #'{:,.2f}'.format(deltoid)
        fundo = tmp.nextFund[0]['nextFunding']
        gav = total.gav
        gav = '{:,.4f}'.format(gav)
        testTable = TABLE()
        row = TR()
        row <= TH("Total Overall")
        row <= TH("%GAV")
        row <= TH("Staked Value")
        row <= TH("Staked %")
        row <= TH("Ave Staked Dur")
        row <= TH("Ave Staked Yield")
        row <= TH("Delta")
        row <= TH("Next Funding")
        testTable <= row
        row = TR()
        row <= TD(overall)
        row <= TD(gav)
        row <= TD(staked)
        row <= TD(calcul)
        row <= TD(total.avg)
        row <= TD(tmp.avg_stake_yield)
        row <= TD(deltoid)
        row <= TD(fundo)
        testTable <= row

        h2_element = document.createElement("h2")
        h2_element.textContent = "Total Balance"
        document["test"].appendChild(h2_element)
        document["test"]<= testTable

    def fund():
        fund_headers = getHeaders(tmp.nextFund)
        fund_values = getValues(tmp.nextFund)
        fund_table = TABLE()
        row = TR()
        for line in fund_headers:
            row <= TH(line)
            fund_table <= row
        for line in fund_values:
            row = TR()
            for value in line:
                row <= TD(value)
                fund_table <= row

        document["fund"]<= fund_table

    def bal():
        bal_headers = getHeaders(tmp.balance)
        bal_value = getValues(tmp.balance)
        bal_table = TABLE()
        row = TR()
        for line in bal_headers:
            row <= TH(line)
            bal_table <= row
        for line in bal_value:
            row = TR()
            for value in line:
                row <= TD(value)
                bal_table <= row
        document["one"]<= bal_table

    def lev():
        lev_headers = getHeaders(tmp.leverage)
        lev_values = getValues(tmp.leverage)
        lev_table = TABLE()
        row = TR()
        for line in lev_headers:
            row <= TH(line)
            lev_table <= row
        for line in lev_values:
            row = TR()
            for value in line:
                row <= TD(value)
                lev_table <= row
        document["two"]<= lev_table

    def risk():
        risk_headers = getHeaders(tmp.position)
        risk_values = getValues(tmp.position)
        risk_table = TABLE()
        row = TR()
        for line in risk_headers:
            row <= TH(line)
            risk_table <= row
        for line in risk_values:
            row = TR()
            for value in line:
                row <= TD(value)
                risk_table <= row
        document["three"]<= risk_table

    def ass():
        asset_headers = getHeaders(tmp.aggAssets)
        asset_values = getValues(tmp.aggAssets)
        asset_table = TABLE()
        row = TR()
        for line in asset_headers:
            row <= TH(line)
            asset_table <= row
        for line in asset_values:
            row = TR()
            for value in line:
                row <= TD(value)
                asset_table <= row

        document["one-three"]<= asset_table

    #fund()
    #bal()
    lev()
    risk()
    ass()
    window.setInterval(speed, 100) # 100 is  100ms
    </script>
    </body>
</html>

